# 03 Why Node.js goes up the directory structure to look for `node_modules`

## What happens when we `npm install ftgu-log-hello-world`

- This is our code:

```js
import 'ftgu-log-hello-world'
```

- It should output "Hello, Mundo" in the end

- Let's `npm install ftgu-log-hello-world` to make it work:

```sh
$ npm install ftgu-hello-world
```

- How does our `node_modules` look like?

```
node_modules/
|
├── ftgu-log-hello-world/
│   ├── package.json # 1.0.0
│   ├── log-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|
├── ftgu-hello-world/
│   ├── package.json # 1.0.0
│   ├── hello-word.js
|   |      > export {hello, world}
|
index.js
   > import 'ftgu-log-hello-world'
```

- When we run `node index.js`, Node.js finds `import 'ftgu-log-hello-world'`.

- As discussed, it finds `node_modules/ftgu-log-hello-world/log-hello-world.js`.

- It runs `node_modules/ftgu-log-hello-world/log-hello-world.js`, which imports `ftgu-hello-world`.

- It looks in `node_modules/ftgu-log-hello-world/node_modules` and doesn't find it.

- Why does `npm` not put it there? Because npm "hoists" it as high as it possibly can!

  - Why? We'll see later.

- So it goes up one directory and finds `node_modules/ftgu-hello-world/`.

- And imports `node_modules/ftgu-hello-world/hello-world.js`.

- So now it works well:

```sh
$ node index.js
Hello, Mondo
```

# What happens when we `npm install ftgu-log-hello-world-chinese`

- Now we run `npm install ftgu-log-hello-world-chinese`.

- The interesting thing here is that `ftgu-log-hello-world` using v1 of `ftgu-hello-world` and
  `ftgu-log-hello-world-chinese` uses v1.1 of `ftgu-hello-world`.

- Will npm install _two_ versions of the package `ftgu-hello-world`? It doesn't have to, because
  `ftgu-hello-world` is willing to accept v1.1 of `ftgu-hello-world`
  (because it uses `^1.0.0` in the dependencies).

- Let's see:

```
node_modules/
|
├── ftgu-log-hello-world/
│   ├── package.json # 1.0.0
│   ├── log-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|
├── ftgu-log-hello-world-chinese/
│   ├── package.json # 1.0.0
│   ├── log-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|
├── ftgu-hello-world/
│   ├── package.json # 1.1.0
│   ├── hello-word.js
|   |      > export {hello, world}
|
index.js
   > import 'ftgu-log-hello-world'
   > import 'ftgu-log-hello-world-chinese'
```

- Now both `ftgu-log-hello-world` and `ftgu-log-hello-world-chinese` will use `ftgu-hello-world` that is now
  v1.1.

- And because Node.js goes up the directory structure when looking for a package, it just works:

```sh
$ node index.js
Hello, Mondo
你好, 世界
```

# What happens when we `npm install ftgu-show-hello-world`

- The package `ftgu-show-hello-world` also uses `ftgu-hello-world`, but it uses v2, which is incompatible with v1!

- So what does the `npm install ftgu-show-hello-world` do?

```
node_modules/
|
├── ftgu-log-hello-world/
│   ├── package.json # 1.0.0
│   ├── log-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|
├── ftgu-log-hello-world-chinese/
│   ├── package.json # 1.0.0
│   ├── log-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|
├── ftgu-show-hello-world/
│   ├── package.json # 1.0.0
│   ├── show-hello-world.js
|   |      > import {hello, world} from 'ftgu-hello-world'
|   |
│   ├── node_modules/
|   |
│   │   ├── ftgu-hello-world/
│   │   │   ├── package.json # 2.0.0
│   │   │   ├── hello-word.js
|   |   |   |      > export {hello, world}
|
├── ftgu-hello-world/
│   ├── package.json # 1.1.0
│   ├── hello-word.js
|   |      > export {hello, world}
|
index.js
   > import 'ftgu-log-hello-world'
   > import 'ftgu-log-hello-world-chinese'
```

- It keeps the previous v1.1 of `ftgu-hello-world` in the same place so that `ftgu-log-hello-world` and
  `ftgu-log-hello-world-chinese` will find it.

- But it adds a `node_modules` with `ftgu-hello-world` v2 _inside_ `ftgu-show-hello-world` so that when
  the `ftgu-show-hello-world/show-hello-world.js` imports `ftgu-hello-world` it will find the correct package
  and not the upper one that is used by the other packages!

- Now `node index.js` imports all three packages:

```js
import 'ftgu-log-hello-world'
import 'ftgu-log-hello-world-chinese'
import 'ftgu-show-hello-world'
```

- And generates the correct output:

```txt
Hello, Mondo
你好, 世界
  _   _      _ _                                    _
 | | | | ___| | | ___     _ __ ___   ___  _ __   __| | ___
 | |_| |/ _ \ | |/ _ \   | '_ ` _ \ / _ \| '_ \ / _` |/ _ \
 |  _  |  __/ | | (_) |  | | | | | | (_) | | | | (_| | (_) |
 |_| |_|\___|_|_|\___( ) |_| |_| |_|\___/|_| |_|\__,_|\___/
                     |/
```
